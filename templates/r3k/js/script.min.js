var ActiveOrderIds=[];function PrintElem(id,event){event.stopPropagation();var mywindow=window.open("/order/"+id,"PRINT");return mywindow.document.close(),mywindow.focus(),setTimeout(()=>{mywindow.print()},"1000"),!0}function getDateByTimezone(date,timezone,culture){return date.toLocaleString(culture,{timeZone:timezone,dateStyle:"full"})}function getTimeByTimezone(date,timezone,culture){return date.toLocaleString(culture,{timeZone:timezone,timeStyle:"long"})}function getDateTimeByTimezone(date,timezone,culture){return date.toLocaleString(culture,{timeZone:timezone,dateStyle:"full",timeStyle:"long"})}function firstLetterCapitalize(_string){return _string.charAt(0).toUpperCase()+_string.slice(1)}function updateTime(){var now=new Date;const CopenhagenDate=getDateByTimezone(now,"Europe/Copenhagen","da-DK"),CopenhagenTime=getTimeByTimezone(now,"Europe/Copenhagen","da-DK");$(".time-text").html(firstLetterCapitalize(CopenhagenDate)+"<br/>"+CopenhagenTime);var nowT=new Date(now.toLocaleString("en",{timeZone:"Europe/Copenhagen"})),later=new Date;later.setMinutes(now.getMinutes()+10),$("input[name='OrderDate']").each((function(){var oDate=new Date($(this).val()),parent=$(this).parents(".card"),parentHeader=$(this).parents(".card-header"),timeRTxt=$(parent).find(".time-remaining"),timeR=(oDate.getTime()-nowT.getTime())/1e3;nowT>oDate&&(timeR=(nowT.getTime()-oDate.getTime())/1e3);const hours=Math.floor(timeR/3600);timeR-=3600*hours;const minutes=Math.floor(timeR/60),seconds=Math.floor(timeR-60*minutes);var t="";hours>0&&(t+=hours+"h"),minutes>0&&(t+=minutes+"m"),seconds>0&&(t+=seconds+"s"),nowT>oDate?($(parentHeader).hasClass("bg-danger")||($(parentHeader).removeClass("bg-warning"),$(parentHeader).removeClass("bg-info"),$(parentHeader).addClass("bg-danger"),$(timeRTxt).addClass("text-danger")),$(timeRTxt).text("+"+t)):later>oDate?($(parentHeader).toggleClass("bg-warning"),$(parentHeader).hasClass("bg-warning")||($(parentHeader).addClass("bg-warning"),$(timeRTxt).addClass("text-warning")),$(timeRTxt).text(t)):$(timeRTxt).text(t)}))}function updateOrderTypeBtn(){$(".btn-type").each((function(){$(this).children(".type-count").text("("+$("div[order-type='"+$(this).attr("title")+"']").length+")"),$("div[order-type='"+$(this).attr("title")+"']").length>0?$(this).prop("hidden",!1):$(this).prop("hidden",!0)}))}function getdatestr(date,seperator){const year=date.getFullYear(),month=String(date.getMonth()+1).padStart(2,"0"),day=String(date.getDate()).padStart(2,"0"),joined=[day,month,year].join(seperator);return joined}function createElementFromHTML(htmlString){var div=document.createElement("div");return div.innerHTML=htmlString.trim(),div.firstChild}function GetNewOrder(){var now,s=getdatestr(new Date,""),secrets=JSON.stringify(userSecrets);$.getJSON("../api/orders/"+s+"-"+s+"?userRefIds="+userRefIds).then(r=>{let fetchedIds=r.data,toRemove=ActiveOrderIds.filter(x=>!fetchedIds.includes(x)),toAdd=fetchedIds.filter(x=>!ActiveOrderIds.includes(x));toRemove&&toRemove.length>0&&toRemove.forEach(x=>{let index=ActiveOrderIds.findIndex(object=>object===x);selectedSlide==x&&(selectedSlide=null,closeBottomBar()),swiperCar.removeSlide(index)}),toAdd&&toAdd.length>0&&toAdd.forEach(x=>{let index=fetchedIds.findIndex(object=>object===x);$.get("/card/"+x,(function(resp){let htmlObject=createElementFromHTML(resp);switch(index){case 0:swiperCar.prependSlide(htmlObject);break;case fetchedIds.length-1:swiperCar.appendSlide(htmlObject);break;default:swiperCar.addSlide(index,htmlObject)}})),playSound()}),ActiveOrderIds=fetchedIds})}$((function(){setInterval(updateTime,1e3)}));