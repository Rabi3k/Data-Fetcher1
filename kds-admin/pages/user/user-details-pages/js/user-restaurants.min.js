const tblComanies=new DataTable("#tblComanies",{columns:[{className:"dt-control",orderable:!1,data:null,defaultContent:""},{data:"id"},{data:"name"},{data:"restaurants",visible:!1},{orderable:!1,data:null,render:function(data,type,row,meta){return`<input class="form-check-input cb-cSelect" type="checkbox" value="${data.id}"/>`}}],createdRow:function(row,data,dataIndex){const exists=$UserRestaurantsIds.some(e=>e.companyId===parseInt(data.id));exists&&($(row).addClass("selected"),$(row).find(".cb-cSelect").prop("checked",!0))}});tblComanies.on("change",".cb-cSelect",(function(e){$(this).parents("tr").toggleClass("selected");let companyId=parseInt($(this).val());$UserRestaurantsIds=addOrRemoveObject($UserRestaurantsIds,{companyId:companyId,restaurantId:null});let tr=$(this).parents("tr");if(!$(tr).hasClass("selected")){let row=tblComanies.row(tr);row.child.isShown()&&row.child.hide()}})),tblComanies.on("change",".cb-rSelect",(function(e){$(this).parents("li").toggleClass("active");let companyId=parseInt($(this).parents("ul").attr("id")),restaurantId=parseInt($(this).val());$UserRestaurantsIds=addOrRemoveObject($UserRestaurantsIds,{companyId:companyId,restaurantId:restaurantId})})),restaurantsSeleted=[];const addOrRemove=(array,item)=>{const exists=array.includes(item);if(exists)return array.filter(c=>c!==item);{const result=array;return result.push(item),result}},addOrRemoveObject=(array,item)=>{if(array.some(e=>e.companyId===item.companyId&&(null===e.restaurantId&&null===item.restaurantId||null!==e.restaurantId&&e.restaurantId.includes(item.restaurantId)))){if(null===item.restaurantId)return array.filter(e=>e.companyId!==item.companyId||!e.restaurantId===item.restaurantId);const result=array,cresult=array.find(e=>e.companyId===item.companyId);return cresult.restaurantId=cresult.restaurantId.filter(e=>e!=item.restaurantId),0===cresult.restaurantId.length&&(cresult.restaurantId=null),result}if(array.some(e=>e.companyId===item.companyId)){const result=array,cresult=array.find(e=>e.companyId===item.companyId);return null===cresult.restaurantId&&(cresult.restaurantId=[]),null===item.restaurantId?array.filter(e=>e.companyId!==item.companyId):(cresult.restaurantId.push(item.restaurantId),result)}{const result=array,cresult={companyId:item.companyId,restaurantId:null};return null!==item.restaurantId&&(cresult.restaurantId=[],cresult.restaurantId.push(item.restaurantId)),result.push(cresult),result}},addOrIgnore=(array,item)=>{const exists=array.includes(item);if(!exists){const result=array;return result.push(item),result}};function format(r,c){rests=JSON.parse(r);let liRests=[];return rests.forEach(v=>{const exists=$UserRestaurantsIds.some(e=>e.companyId===parseInt(c)&&null!==e.restaurantId&&e.restaurantId.includes(parseInt(v.id)));let lirest=`<li class="list-group-item ${exists?"active":""} ">\n                    <div class="row">\n                        <div class="col"></div>\n                        <div class="col">\n                            ${v.alias}\n                        </div>\n                        <div class="col">\n                            ${v.city}\n                        </div>\n                        <div class="col">\n                        <input class="form-check-input cb-rSelect" type="checkbox" value="${v.id}" ${exists?"checked":""} />\n                        </div>\n                    </div>\n                </li>`;liRests.push(lirest)}),`<ul class="list-group list-group-info bg-light text-dark" id="${c}">${liRests.join("")}</ul>`}tblComanies.on("click","td.dt-control",(function(e){e.preventDefault();let tr=e.target.closest("tr"),row=tblComanies.row(tr);row.child.isShown()?row.child.hide():$(tr).hasClass("selected")&&row.child(format(row.data().restaurants,row.data().id)).show()})),$("#btn-save-userRelations").click((function(e){let $userRelations={userId:parseInt("<?php echo $lUser->id; ?>"),relations:$UserRestaurantsIds};var settings={url:"/sessionservices/users.php?q=set-user-relations",method:"PUT",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify($userRelations),success:function(data){showAlert("User-relations saved successfully")}};$.ajax(settings).done((function(response){console.log(response)}))}));