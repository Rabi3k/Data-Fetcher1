var tblItems=new DataTable("#tblItems",{dom:'<"container-fluid pt-2"<"row"<"col"l><"col d-flex justify-content-center"f><"col d-flex justify-content-end"B>>>rtip',buttons:[{className:"toogle-items select-all btn btn-sm btn-info",text:"",attr:{"for-ul":"items"}}],columns:[{class:"dt-control",orderable:!1,data:null,defaultContent:""},{target:1,visible:!0},{target:2,visible:!0},{target:3,visible:!0,data:"category"},{target:4,visible:!0,data:"price",render:function(data,type,row){let currencyLocal;return new Intl.NumberFormat("da-DK",{style:"currency",currency:"DKK"}).format(data)}},{target:5,visible:!1,data:"options"},{target:6,visible:!1},{target:7,visible:!1},{target:8,visible:!0}],initComplete:function(){this.api().columns(3).every((function(){let column=this,select=document.createElement("select");select.add(new Option("")),column.footer().replaceChildren(select),select.addEventListener("change",(function(){var val=DataTable.util.escapeRegex(select.value);column.search(val?"^"+val+"$":"",!0,!1).draw()})),column.data().unique().sort().each((function(d,j){select.add(new Option(d))}))}))}});const detailItemsRows=[];function format(d){let options=JSON.parse(d.options);return optionsLines=[],options.forEach(item=>{let currencyLocal=new Intl.NumberFormat("da-DK",{style:"currency",currency:"DKK"}),str=`<li class="menu option list-group-item form-control" lid="${item.loyverse_id}" name="${item.name}" price="${item.price}">\n            <span class="spinner spinner-border spinner-border-sm float-end visually-hidden" role="status" aria-hidden="true"></span>\n            <span class="fs-6 fw-semibold">${item.name}</span>\n            <span class="fs-6 float-end"> ${currencyLocal.format(item.price)}</span>\n            </li>`;optionsLines.push(str)}),'<ul class="options card list-group  overflow-auto max-list-5">'+optionsLines.join("")+"</ul>"}function PostItem(data,elem){var settings={url:"/sessionservices/integration.php?q=postitem",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:data,success:function(response){console.log(response),$(elem).find(".spinner").toggleClass("visually-hidden"),$(elem).addClass("is-valid"),$(elem).find("li.variant").addClass("is-valid"),$($(elem).find(".spinner")).parent("td").addClass("is-valid"),$(elem).addClass("is-valid")}};$.ajax(settings).fail((function(response){console.log(response),$(elem).find(".spinner").toggleClass("visually-hidden"),$(elem).addClass("is-invalid"),$(elem).find("li.variant").addClass("is-invalid")}))}tblItems.on("click","tbody td.dt-control",(function(){let tr=event.target.closest("tr"),row=tblItems.row(tr),idx=detailItemsRows.indexOf(tr.id);row.child.isShown()?(tr.classList.remove("details"),row.child.hide(),detailItemsRows.splice(idx,1)):(tr.classList.add("details"),row.child(format(row.data())).show(),-1===idx&&detailItemsRows.push(tr.id))})),tblItems.on("draw",()=>{detailItemsRows.forEach((id,i)=>{let el=document.querySelector("#"+id+" td.dt-control");el&&el.dispatchEvent(new Event("click",{bubbles:!0}))})}),$("#btnPostItemsT").on("click",(function(){let integrationId=$(hdfIntegrationId).val(),gfMenuId=$(txtGfMenuId).text();$("tr.item.has-issue,tr.item.is-invalid").each((function(key,value){$(this).find(".spinner").toggleClass("visually-hidden"),$(this).removeClass("has-issue"),$(this).removeClass("is-invalid");let gfid=$(this).attr("id").substring(2),data;items[gfid].integration_id=integrationId,items[gfid].gf_menu_id=gfMenuId,PostItem(JSON.stringify(items[gfid]),this)}))}));