var tblModifiers=new DataTable("#tblModifiers",{dom:'<"container-fluid pt-2"<"row"<"col"l><"col d-flex justify-content-center"f><"col d-flex justify-content-end"B>>>rtip',buttons:[{className:"toogle-items select-all btn btn-sm btn-info",text:"Select All",attr:{"for-ul":"modifiers"}}],columns:[{class:"dt-control",orderable:!1,data:null,defaultContent:""},{target:1,visible:!0},{target:2,visible:!0},{target:3,visible:!1,data:"options"},{target:4,visible:!1},{target:5,visible:!1},{target:6,visible:!0}]});const detailRows=[];function format(d){let options=JSON.parse(d.options);return optionsLines=[],options.forEach(item=>{let currencyLocal=new Intl.NumberFormat("da-DK",{style:"currency",currency:"DKK"}),str=`<li class="menu option list-group-item form-control" lid="${item.loyverse_id}" name="${item.name}" price="${item.price}">\n            <span class="spinner spinner-border spinner-border-sm float-end visually-hidden" role="status" aria-hidden="true"></span>\n            <span class="fs-6 fw-semibold">${item.name}</span>\n            <span class="fs-6 float-end"> ${currencyLocal.format(item.price)}</span>\n            </li>`;optionsLines.push(str)}),'<ul class="options card list-group  overflow-auto max-list-5">'+optionsLines.join("")+"</ul>"}function PostModifier(data,elem){var settings={url:"/sessionservices/integration.php?q=postmodifier",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:data,success:function(response){console.log(response),$(elem).find(".spinner").toggleClass("visually-hidden"),$(elem).addClass("is-valid"),$(elem).find("li.option").addClass("is-valid"),$($(elem).find(".spinner")).parent("td").addClass("is-valid"),$(elem).addClass("is-valid")}};$.ajax(settings).fail((function(response){console.log(response),$(elem).find(".spinner").toggleClass("visually-hidden"),$(elem).addClass("is-invalid"),$(elem).find("li.option").addClass("is-invalid"),$($(elem).find(".spinner")).parent("td").addClass("is-valid")}))}tblModifiers.on("click","tbody td.dt-control",(function(){let tr=event.target.closest("tr"),row=tblModifiers.row(tr),idx=detailRows.indexOf(tr.id);row.child.isShown()?(tr.classList.remove("details"),row.child.hide(),detailRows.splice(idx,1)):(tr.classList.add("details"),row.child(format(row.data())).show(),-1===idx&&detailRows.push(tr.id))})),tblModifiers.on("draw",()=>{detailRows.forEach((id,i)=>{let el=document.querySelector("#"+id+" td.dt-control");el&&el.dispatchEvent(new Event("click",{bubbles:!0}))})}),$("#btnPostModifiersT").on("click",(function(){let integrationId=$(hdfIntegrationId).val(),gfMenuId=$(txtGfMenuId).text();$("tr.modifier.has-issue,tr.modifier.is-invalid").each((function(key,value){$(this).find(".spinner").toggleClass("visually-hidden"),$(this).removeClass("has-issue"),$(this).removeClass("is-invalid");let options=[],optionsObj;JSON.parse(tblModifiers.row(this).data().options).forEach((function(oVal){let id=oVal.id;options.push({gf_id:oVal.id,l_id:oVal.loyverse_id,name:oVal.name,price:parseInt(oVal.price)})}));let gfid=$(value).attr("id").substring(2),lid=$(value).attr("lid"),name=$(value).attr("name"),data=JSON.stringify({integration_id:integrationId,gf_menu_id:gfMenuId,gf_id:gfid,l_id:lid,name:name,options:options});console.log(data),PostModifier(data,this)}))}));